{% extends "base.html" %}
{% load static %}

{% block content %}
<section class="text-gray-600 body-font overflow-hidden">
	<div class="container px-5 py-8 mx-auto"> <!-- Reduced top padding for starting a bit top -->
	  <div class="flex justify-center"> <!-- Added for horizontal centering -->
		<div class="lg:w-4/5 flex flex-wrap justify-center"> <!-- Adjusted for center alignment and wrapping -->
		  <div class="lg:w-1/2 w-full lg:pr-10 lg:py-6 mb-6 lg:mb-0">
			<h2 class="text-sm title-font text-gray-500 tracking-widest">LEAD</h2>
			<div class="flex items-center gap-4 mb-4">
			  <div class="w-20 h-20 rounded-full border-2 border-gray-300 bg-gray-200 overflow-hidden flex-shrink-0 flex items-center justify-center relative">
				{% if lead.profile_image %}
				  <img src="{{ lead.profile_image.url }}" alt="{{ lead.first_name }} {{ lead.last_name }}" class="w-full h-full object-cover absolute inset-0" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
				{% endif %}
				<img src="{% static 'images/crm-logo.png' %}" alt="Darkenyas CRM" class="profile-img-fallback w-full h-full object-cover" style="{% if lead.profile_image %}display:none;{% endif %}">
			  </div>
			  <h1 class="text-gray-900 text-3xl title-font font-medium">{{ lead.first_name }} {{ lead.last_name }}</h1>
			</div>
			<div class="flex mb-4">
			  <a href="{% url 'leads:lead-detail' lead.pk %}" class="flex-grow text-indigo-500 border-b-2 border-indigo-500 py-2 text-lg px-1">
				Overview
			  </a>
			  <a href="{% url 'leads:lead-category-update' lead.pk %}" class="flex-grow border-b-2 border-gray-300 py-2 text-lg px-1">
				 Category
			  </a>
			  {% if not request.user.is_agent %}
			  <a href="{% url 'leads:lead-update' lead.pk %}" class="flex-grow border-b-2 border-gray-300 py-2 text-lg px-1">
				 Update Details
			  </a>
			  {% endif %}
			  <a href="{% url 'leads:lead-activity' lead.pk %}" class="flex-grow border-b-2 border-gray-300 py-2 text-lg px-1">
				Lead Activity
			  </a>
			</div>
			<p class="leading-relaxed mb-4">{{ lead.description }}</p>
			<div class="flex border-t border-gray-200 py-2">
			  <span class="text-gray-500">Age</span>
			  <span class="ml-auto text-gray-900">{{ lead.age }}</span>
			</div>
			<div class="flex border-t border-gray-200 py-2">
			  <span class="text-gray-500">Email</span>
			  <span class="ml-auto text-gray-900">{{ lead.email }}</span>
			</div>
			<div class="flex border-t border-gray-200 py-2">
			  <span class="text-gray-500">Phone Number</span>
			  <span class="ml-auto text-gray-900">{{ lead.phone_number }}</span>
			</div>
			<div class="flex border-t border-gray-200 py-2">
			  <span class="text-gray-500">Address</span>
			  <span class="ml-auto text-gray-900">{{ lead.address }}</span>
			</div>
			{% if request.user.is_superuser and lead.organisation %}
			<div class="flex border-t border-gray-200 py-2">
			  <span class="text-gray-500">Organisation</span>
			  <span class="ml-auto text-gray-900">{{ lead.organisation.user.get_full_name|default:lead.organisation.user.username }} ({{ lead.organisation.user.email }})</span>
			</div>
			{% endif %}
			<div class="flex border-t border-gray-200 py-2">
			  <span class="text-gray-500">Source</span>
			  <span class="ml-auto text-blue-600 font-medium">{{ lead.source_category.name|default:"Unassigned" }}</span>
			</div>
			<div class="flex border-t border-gray-200 py-2">
			  <span class="text-gray-500">Value</span>
			  <span class="ml-auto text-green-600 font-medium">{{ lead.value_category.name|default:"Unassigned" }}</span>
			</div>
			{% if not request.user.is_agent %}
			<div class="flex border-t border-b border-gray-200 py-2">
			  <span class="text-gray-500">Agent</span>
			  <span class="ml-auto text-purple-600 font-medium">{{ lead.agent.user.username|default:"Unassigned" }}</span>
			</div>
			{% endif %}
			<!-- Back to all leads Link -->
			<div class="mt-6">
			  <a class="hover:text-blue-500" href="{% url 'leads:lead-list' %}">Back to all leads</a>
			</div>
		  </div>
		</div>
	  </div>
	</div>
</section>
{% endblock content %}