{% extends "base.html" %}
{% load tailwind_filters %}

{% block content %}
<section class="text-gray-600 body-font overflow-hidden">
	<div class="container px-5 py-12 mx-auto"> <!-- Reduced py-24 to py-12 to start higher -->
	  <div class="lg:w-4/5 mx-auto flex flex-wrap justify-center"> <!-- Added justify-center to center content -->
		<div class="lg:w-1/2 w-full lg:pr-10 lg:py-6 mb-6 lg:mb-0">
			<h2 class="text-sm title-font text-gray-500 tracking-widest">PRODUCT AND STOCK</h2>
			<h1 class="text-gray-900 text-3xl title-font font-medium mb-4">{{ object.first_name }}</h1>
			<div class="flex mb-4">
			   <a href="{% url 'ProductsAndStock:ProductAndStock-detail' object.pk %}" class="flex-grow border-b-2 border-gray-300 py-2 text-lg px-1">
				   Overview
			   </a>
			   <a href="{% url 'ProductsAndStock:ProductAndStock-update' object.pk %}" class="flex-grow text-indigo-500 border-b-2 border-indigo-500 py-2 text-lg px-1">
				  Update Details
			   </a>
			 </div>
			 <form method="post">
			 {% csrf_token %}  
			 {{ form|crispy }}
			<button type="submit" class="w-full text-white bg-blue-500 hover:bg-blue-600 px-3 py-2 rounded-md">Update</button>
		  </form>
		  <div class="mt-5 py-5 border-t border-gray-200">
			<a href="{% url 'ProductsAndStock:ProductAndStock-delete' object.pk %}" class="w-1/2 mt-3 text-white bg-indigo-500 border-0 py-2 px-6 focus:outline-none hover:bg-indigo-600 rounded">
			  Delete
			</a>
		  </div>
		  <a class="hover:text-blue-500 mt-3" href="{% url 'ProductsAndStock:ProductAndStock-list' %}">Go back to Products and Stock</a>
		</div>
	  </div>
	</div>
  </section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const categorySelect = document.getElementById('id_category');
    const subcategorySelect = document.getElementById('id_subcategory');
    
    if (categorySelect && subcategorySelect) {
        // Store the current subcategory value
        const currentSubcategoryId = subcategorySelect.value;
        
        categorySelect.addEventListener('change', function() {
            const categoryId = this.value;
            
            // Clear subcategory options
            subcategorySelect.innerHTML = '<option value="">Select Sub Category *</option>';
            
            if (categoryId) {
                // Make AJAX request to get subcategories
                fetch(`/ProductsAndStock/get-subcategories/?category_id=${categoryId}`)
                    .then(response => response.json())
                    .then(data => {
                        data.subcategories.forEach(subcategory => {
                            const option = document.createElement('option');
                            option.value = subcategory.id;
                            option.textContent = subcategory.name;
                            
                            // Select the option if it matches the current subcategory
                            if (currentSubcategoryId && subcategory.id == currentSubcategoryId) {
                                option.selected = true;
                            }
                            
                            subcategorySelect.appendChild(option);
                        });
                    })
                    .catch(error => {
                        console.error('Error loading subcategories:', error);
                    });
            }
        });
        
        // Trigger the change event on page load to populate subcategories
        if (categorySelect.value) {
            categorySelect.dispatchEvent(new Event('change'));
        }
    }
});
</script>
{% endblock content %}