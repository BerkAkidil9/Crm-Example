{% extends "base.html" %}

{% block content %}
<div class="max-w-4xl mx-auto py-8 px-4">
	<div class="flex justify-between items-start mb-8">
		<div>
			<a href="{% url 'orders:order-list' %}" class="text-gray-500 hover:text-gray-700 font-medium mb-2 inline-block">← Back to orders</a>
			<h1 class="text-3xl font-bold text-gray-800">{{ order.order_name }}</h1>
			<p class="text-gray-500 mt-1">
				{{ order.order_day|date:"F d, Y" }}
				{% if order.is_cancelled %}<span class="ml-2 px-2 py-0.5 text-xs font-medium rounded-full bg-red-100 text-red-800">Cancelled</span>{% endif %}
			</p>
		</div>
		<div class="flex gap-2">
			{% if not order.is_cancelled %}
			<a href="{% url 'orders:order-update' order.pk %}" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-medium">Edit order</a>
			<a href="{% url 'orders:order-delete' order.pk %}" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 text-sm font-medium">Cancel / Delete</a>
			{% endif %}
		</div>
	</div>

	<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
		<!-- Main content -->
		<div class="lg:col-span-2 space-y-6">
			<div class="bg-white rounded-xl border border-gray-200 shadow-sm p-6">
				<h2 class="text-lg font-semibold text-gray-800 mb-2">Description</h2>
				<p class="text-gray-600 whitespace-pre-wrap">{{ order.order_description }}</p>
			</div>

			<div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden">
				<h2 class="text-lg font-semibold text-gray-800 p-6 pb-0">Order items</h2>
				{% if order_items %}
				<div class="overflow-x-auto">
					<table class="min-w-full divide-y divide-gray-200">
						<thead class="bg-gray-50">
							<tr>
								<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Product</th>
								<th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Qty</th>
								<th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Unit price</th>
								<th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Total</th>
							</tr>
						</thead>
						<tbody class="bg-white divide-y divide-gray-200">
							{% for item in order_items %}
							<tr>
								<td class="px-6 py-4 text-sm font-medium text-gray-900">{{ item.product.product_name }}</td>
								<td class="px-6 py-4 text-sm text-gray-500 text-right">{{ item.product_quantity }}</td>
								<td class="px-6 py-4 text-sm text-gray-500 text-right">${{ item.product.product_price|floatformat:2 }}</td>
								<td class="px-6 py-4 text-sm font-medium text-gray-900 text-right">${{ item.total_price|floatformat:2 }}</td>
							</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
				<div class="px-6 py-4 bg-gray-50 border-t border-gray-200 flex justify-end">
					<span class="text-base font-semibold text-gray-800">Total: ${{ total_order_price|floatformat:2 }}</span>
				</div>
				{% else %}
				<p class="p-6 text-gray-500 text-sm">No products in this order.</p>
				{% endif %}
			</div>
		</div>

		<!-- Sidebar -->
		<div class="space-y-6">
			<div class="bg-white rounded-xl border border-gray-200 shadow-sm p-6">
				<h2 class="text-sm font-medium text-gray-500 uppercase tracking-wide mb-3">Details</h2>
				<dl class="space-y-3">
					{% if request.user.is_superuser and order.organisation %}
					<div>
						<dt class="text-xs text-gray-500">Organisation</dt>
						<dd class="text-sm font-medium text-gray-900 mt-0.5">{{ order.organisation.user.username }}{% if order.organisation.user.email %} <span class="text-gray-500 font-normal">({{ order.organisation.user.email }})</span>{% endif %}</dd>
					</div>
					{% endif %}
					<div>
						<dt class="text-xs text-gray-500">Lead / Customer</dt>
						<dd class="text-sm font-medium text-gray-900 mt-0.5">
							{% if order.lead %}{{ order.lead.first_name }} {{ order.lead.last_name }}{% if order.lead.email %} <span class="text-gray-500 font-normal">({{ order.lead.email }})</span>{% endif %}{% else %}<span class="text-gray-400">— Not set</span>{% endif %}
						</dd>
					</div>
					{% if order.lead and order.lead.agent %}
					<div>
						<dt class="text-xs text-gray-500">Agent</dt>
						<dd class="text-sm font-medium text-gray-900 mt-0.5">{{ order.lead.agent.user.username }}{% if order.lead.agent.user.email %} <span class="text-gray-500 font-normal">({{ order.lead.agent.user.email }})</span>{% endif %}</dd>
					</div>
					{% endif %}
					<div>
						<dt class="text-xs text-gray-500">Order date / time</dt>
						<dd class="text-sm font-medium text-gray-900 mt-0.5">{{ order.order_day|date:"M d, Y H:i" }}</dd>
					</div>
					<div>
						<dt class="text-xs text-gray-500">Created</dt>
						<dd class="text-sm font-medium text-gray-900 mt-0.5">{{ order.creation_date|date:"M d, Y H:i" }}</dd>
					</div>
					<div>
						<dt class="text-xs text-gray-500">Items</dt>
						<dd class="text-sm font-medium text-gray-900 mt-0.5">{{ order_items|length }} product(s)</dd>
					</div>
				</dl>
			</div>
		</div>
	</div>
</div>
{% endblock %}
