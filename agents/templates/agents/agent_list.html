{% extends "base.html" %}
{% load static %}

{% block content %}


     <section class="text-gray-600 body-font">
        <div class="container px-5 py-24 mx-auto flex flex-wrap">
           <div class="w-full mb-6 py-6 flex justify-between items-center borber-b border-gray-200">
                 <div>
                        <h1 class="text-4xl text-gray-800">Agents</h1>
                  </div>
                  <div>
                   <a class="text-gray-500 hover:text-blue-500 "href="{% url 'agents:agent-create' %}">Create a new agent</a>
                   </div>
           </div>

           <!-- Search & filters -->
           <div class="w-full mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200">
                <form method="get" action="{% url 'agents:agent-list' %}" class="flex flex-wrap items-end gap-3">
                     <div class="flex-1 min-w-[200px]">
                          <label for="agent-search" class="block text-sm font-medium text-gray-700 mb-1">Search</label>
                          <input type="text" name="q" id="agent-search" value="{{ search_query }}"
                                 placeholder="Username, name, email..."
                                 class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                     </div>
                     {% if request.user.is_superuser %}
                     <div>
                          <label for="agent-org" class="block text-sm font-medium text-gray-700 mb-1">Organisation</label>
                          <select name="organisation" id="agent-org" class="px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500">
                               <option value="">All</option>
                               {% for org in filter_organisations %}
                               <option value="{{ org.id }}" {% if current_organisation_id == org.id|stringformat:"s" %}selected{% endif %}>{{ org.user.username }}</option>
                               {% endfor %}
                          </select>
                     </div>
                     {% endif %}
                     <button type="submit" class="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500">Filter</button>
                     {% if search_query or current_organisation_id %}
                     <a href="{% url 'agents:agent-list' %}" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300">Clear</a>
                     {% endif %}
                </form>
           </div>

            <div class="flex flex-wrap -m-4">
                 {% for agent in object_list %}
                 <div class="p-4 w-full">
                     <div class="flex border-2 {% if agent.user == request.user %}border-blue-500 bg-blue-50{% else %}border-gray-600{% endif %} p-8 sm:flex-row flex-col">
                           <div class="w-16 h-16 sm:mr-8 sm:mb-0 mb-4 rounded-full flex-shrink-0 relative flex items-center justify-center">
                           {% if agent.user.profile_image %}
                           <img src="{{ agent.user.profile_image.url }}" alt="Profile" class="w-16 h-16 rounded-full object-cover absolute inset-0 border-2 border-gray-200" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                           {% endif %}
                           <img src="{% static 'images/crm-logo.png' %}" alt="Darkenyas CRM" class="profile-img-fallback w-16 h-16 rounded-full object-cover" style="{% if agent.user.profile_image %}display:none;{% endif %}">
                           </div>
                           <div class="flex-grow">
                               <h2 class="text-gray-900 text-lg title-font font-medium mb-3">
                                {{ agent.user.username }} {% if agent.user == request.user %}<span class="text-blue-600 text-sm">(You)</span>{% endif %}</h2>
                          <div class="leading-relaxed text-base mb-3">
                              <p class="mb-1"><strong>Name:</strong> {{ agent.user.first_name }} {{ agent.user.last_name }}</p>
                              <p class="mb-1"><strong>Email:</strong> {{ agent.user.email }}</p>
                              <p class="mb-1"><strong>Phone:</strong> {{ agent.user.phone_number|default:"Not provided" }}</p>
                              <p class="mb-1"><strong>Date of Birth:</strong> {% if agent.user.date_of_birth %}{{ agent.user.date_of_birth|date:"d/m/Y" }}{% else %}Not provided{% endif %}</p>
                              <p class="mb-1"><strong>Gender:</strong> {% if agent.user.gender %}{{ agent.user.get_gender_display }}{% else %}Not provided{% endif %}</p>
                              <p class="mb-1"><strong>Status:</strong> {% if agent.user.email_verified %}<span class="text-green-600 font-medium">✓ Verified</span>{% else %}<span class="text-orange-600 font-medium">⏳ Pending Verification</span>{% endif %}</p>
                              {% if request.user.is_superuser %}
                              <p class="mb-1"><strong>Organisation:</strong> <span class="text-purple-600 font-medium">{{ agent.organisation.user.username }}</span></p>
                              {% endif %}
                          </div>
                               <a href="{% url 'agents:agent-detail' agent.pk %}" class="mt-3 text-indigo-500 inline-flex items-center hover:text-blue-900">
                                View agent
                                  <svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="w-4 h-4 ml-2" viewBox="0 0 24 24">
                                  <path d="M5 12h14M12 5l7 7-7 7"></path>
                                  </svg>
                               </a>
                           </div>
                       </div>
                 </div>
                 {% endfor %}
           </div>
        </div>
      </section>   


{% endblock content %}